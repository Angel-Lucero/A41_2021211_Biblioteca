<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<h:head>
    <title>Gestión de Libros - Biblioteca</title>
    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css"/>
</h:head>
<h:body>
    <div class="card">
        <h:form id="form-libros">
            <p:growl id="mensajes" showDetail="true" life="3000"/>

            <div class="flex justify-content-between align-items-center mb-4">
                <h2>Gestión de Libros</h2>
                <p:button value="Volver al Inicio" outcome="index" icon="pi pi-home"/>
            </div>

            <p:toolbar>
                <p:toolbarGroup>
                    <p:commandButton value="Nuevo Libro" icon="pi pi-plus"
                                     actionListener="#{libroController.prepararNuevoLibro}"
                                     update=":form-dialog:panel-libro"
                                     oncomplete="PF('dlgLibro').show()"/>
                </p:toolbarGroup>
                <p:toolbarGroup>
                    <p:inputText placeholder="Buscar..." id="globalFilter" style="width: 250px"/>
                </p:toolbarGroup>
            </p:toolbar>

            <p:dataTable id="tablaLibros" var="libro" value="#{libroController.libros}"
                         paginator="true" rows="10" rowsPerPageTemplate="5,10,15"
                         filteredValue="#{libroController.librosFiltrados}"
                         emptyMessage="No se encontraron libros">
                <f:facet name="header">
                    <div class="flex justify-content-between">
                        <span>Listado de Libros</span>
                        <p:inputText placeholder="Buscar..." onkeyup="PF('tablaLibros').filter()"
                                     style="width: 200px"/>
                    </div>
                </f:facet>

                <p:column headerText="ID" sortBy="#{libro.idlibro}" filterBy="#{libro.idlibro}">
                    <h:outputText value="#{libro.idlibro}"/>
                </p:column>

                <p:column headerText="Título" sortBy="#{libro.titulo}" filterBy="#{libro.titulo}"
                          filterMatchMode="contains">
                    <h:outputText value="#{libro.titulo}"/>
                </p:column>

                <p:column headerText="Autor" sortBy="#{libro.autor}" filterBy="#{libro.autor}"
                          filterMatchMode="contains">
                    <h:outputText value="#{libro.autor}"/>
                </p:column>

                <p:column headerText="Género ID" sortBy="#{libro.idgenero}" filterBy="#{libro.idgenero}">
                    <h:outputText value="#{libro.idgenero}"/>
                </p:column>

                <p:column headerText="Ubicación ID" sortBy="#{libro.idubicacion}" filterBy="#{libro.idubicacion}">
                    <h:outputText value="#{libro.idubicacion}"/>
                </p:column>

                <p:column headerText="Cantidad" sortBy="#{libro.cantidad}" filterBy="#{libro.cantidad}">
                    <h:outputText value="#{libro.cantidad}"/>
                </p:column>

                <p:column headerText="Acciones" style="width: 120px">
                    <p:commandButton icon="pi pi-pencil" title="Editar"
                                     actionListener="#{libroController.prepararEditarLibro(libro)}"
                                     update=":form-dialog:panel-libro"
                                     oncomplete="PF('dlgLibro').show()"/>
                    <p:commandButton icon="pi pi-trash" title="Eliminar"
                                     actionListener="#{libroController.eliminarLibro(libro)}"
                                     update=":form-libros:mensajes, :form-libros:tablaLibros"
                                     styleClass="p-button-danger"/>
                </p:column>
            </p:dataTable>
        </h:form>

        <h:form id="form-dialog">
            <p:dialog header="Detalles del Libro" widgetVar="dlgLibro" modal="true"
                      responsive="true" width="500" closeOnEscape="true">
                <p:outputPanel id="panel-libro" class="ui-fluid">
                    <div class="field">
                        <p:outputLabel for="titulo" value="Título *"/>
                        <p:inputText id="titulo" value="#{libroController.libroSeleccionado.titulo}"
                                     required="true" requiredMessage="El título es obligatorio"/>
                    </div>
                    <div class="field">
                        <p:outputLabel for="autor" value="Autor *"/>
                        <p:inputText id="autor" value="#{libroController.libroSeleccionado.autor}"
                                     required="true" requiredMessage="El autor es obligatorio"/>
                    </div>
                    <div class="field">
                        <p:outputLabel for="idgenero" value="ID Género"/>
                        <p:inputNumber id="idgenero" value="#{libroController.libroSeleccionado.idgenero}"
                                       min="0"/>
                    </div>
                    <div class="field">
                        <p:outputLabel for="idubicacion" value="ID Ubicación"/>
                        <p:inputNumber id="idubicacion" value="#{libroController.libroSeleccionado.idubicacion}"
                                       min="0"/>
                    </div>
                    <div class="field">
                        <p:outputLabel for="cantidad" value="Cantidad"/>
                        <p:inputNumber id="cantidad" value="#{libroController.libroSeleccionado.cantidad}"
                                       min="0"/>
                    </div>
                </p:outputPanel>

                <f:facet name="footer">
                    <p:commandButton value="Guardar" icon="pi pi-check"
                                     actionListener="#{libroController.guardarLibro}"
                                     update=":form-libros:mensajes, :form-libros:tablaLibros"
                                     oncomplete="if(!args.validationFailed) PF('dlgLibro').hide()"/>
                    <p:commandButton value="Cancelar" icon="pi pi-times"
                                     onclick="PF('dlgLibro').hide()" type="button"/>
                </f:facet>
            </p:dialog>
        </h:form>
    </div>
</h:body>
</html>